make[1]: Entering directory '/home/runner/work/moq-interop-runner/moq-interop-runner/main'
rm -rf mlog/
mkdir -p mlog/relay mlog/client
Running interop tests...
  Relay:  ghcr.io/englishm/moq-interop-runner-moq-relay-ietf:latest
  Client: ghcr.io/facebookexperimental/moxygen-interop-client:latest-amd64
RELAY_IMAGE=ghcr.io/englishm/moq-interop-runner-moq-relay-ietf:latest CLIENT_IMAGE=ghcr.io/facebookexperimental/moxygen-interop-client:latest-amd64 \
	docker compose -f docker-compose.test.yml up --abort-on-container-exit
time="2026-02-15T00:39:44Z" level=warning msg="The \"PORT\" variable is not set. Defaulting to a blank string."
time="2026-02-15T00:39:44Z" level=warning msg="The \"PORT\" variable is not set. Defaulting to a blank string."
time="2026-02-15T00:39:44Z" level=warning msg="The \"PORT\" variable is not set. Defaulting to a blank string."
time="2026-02-15T00:39:44Z" level=warning msg="The \"HEX\" variable is not set. Defaulting to a blank string."
time="2026-02-15T00:39:44Z" level=warning msg="The \"HEX\" variable is not set. Defaulting to a blank string."
 Container main-relay-1  Recreate
 Container main-relay-1  Recreated
 Container main-test-client-1  Recreate
 Container main-test-client-1  Recreated
Attaching to relay-1, test-client-1
relay-1  | Starting moq-rs relay on port 4443
relay-1  |   Cert: /certs/cert.pem
relay-1  |   Key:  /certs/priv.key
relay-1  |   Mlog: /mlog
test-client-1  | TAP version 14
test-client-1  | # moxygen interop test client
test-client-1  | # Relay: https://relay:4443
test-client-1  | # Transport: WebTransport
test-client-1  | 1..6
test-client-1  | W0215 00:40:00.840207     1 MoQWebTransportClient.cpp:180] WebTransport: No WT-Protocol header in response, will use legacy version negotiation
test-client-1  | E0215 00:40:00.840921     1 MoQSession.cpp:2573] proxygen::WebTransport::Exception: session terminated with error=386759528 id=4 sess=0x563e769e46b0
test-client-1  | ok 1 - setup-only
test-client-1  |   ---
test-client-1  |   duration_ms: 9
test-client-1  |   info: SETUP exchange completed successfully
test-client-1  |   ...
test-client-1  | W0215 00:40:00.847289     1 MoQWebTransportClient.cpp:180] WebTransport: No WT-Protocol header in response, will use legacy version negotiation
test-client-1  | E0215 00:40:00.848729     1 MoQRelaySession.cpp:681] PublishNamespaceDone for unknown publishNamespace, sess=0x563e769f9450
test-client-1  | E0215 00:40:00.848896     1 MoQSession.cpp:2573] proxygen::WebTransport::Exception: session terminated with error=386759528 id=4 sess=0x563e769f9450
test-client-1  | ok 2 - announce-only
test-client-1  |   ---
test-client-1  |   duration_ms: 7
test-client-1  |   info: PUBLISH_NAMESPACE completed successfully
test-client-1  |   ...
test-client-1  | W0215 00:40:00.855309     1 MoQWebTransportClient.cpp:180] WebTransport: No WT-Protocol header in response, will use legacy version negotiation
relay-1        | [2026-02-15T00:40:00Z ERROR moq_transport::session::reader] [READER] decode: ERROR decoding moq_transport::message::Message - InvalidFilterType (buffer_len=37)
test-client-1  | E0215 00:40:00.855916     1 MoQWebTransportClient.cpp:205] proxygen::HTTPException: Got error=ApplicationError: No Error, Client closed by peer reason=
test-client-1  | E0215 00:40:00.856023     1 MoQSession.cpp:2573] proxygen::WebTransport::Exception: received invalid reset_stream with error=0 id=4 sess=0x563e76a08740
test-client-1  | ok 3 - subscribe-error
test-client-1  |   ---
test-client-1  |   duration_ms: 7
test-client-1  |   info: Subscribe correctly returned error: Session closed
test-client-1  |   ...
test-client-1  | W0215 00:40:00.862827     1 MoQWebTransportClient.cpp:180] WebTransport: No WT-Protocol header in response, will use legacy version negotiation
test-client-1  | W0215 00:40:00.869823     1 MoQWebTransportClient.cpp:180] WebTransport: No WT-Protocol header in response, will use legacy version negotiation
relay-1        | [2026-02-15T00:40:00Z ERROR moq_transport::session::reader] [READER] decode: ERROR decoding moq_transport::message::Message - InvalidFilterType (buffer_len=42)
test-client-1  | E0215 00:40:00.870442     1 MoQWebTransportClient.cpp:205] proxygen::HTTPException: Got error=ApplicationError: No Error, Client closed by peer reason=
test-client-1  | E0215 00:40:00.870516     1 MoQSession.cpp:2573] proxygen::WebTransport::Exception: received invalid reset_stream with error=0 id=4 sess=0x563e76a29ac0
test-client-1  | E0215 00:40:00.870723     1 MoQSession.cpp:2573] proxygen::WebTransport::Exception: session terminated with error=386759528 id=4 sess=0x563e76a165f0
test-client-1  | not ok 4 - announce-subscribe
test-client-1  |   ---
test-client-1  |   duration_ms: 14
test-client-1  |   error: Subscribe failed: Session closed
test-client-1  |   ...
test-client-1  | W0215 00:40:00.877137     1 MoQWebTransportClient.cpp:180] WebTransport: No WT-Protocol header in response, will use legacy version negotiation
test-client-1  | ok 5 - publish-namespace-done
test-client-1  |   ---
test-client-1  |   duration_ms: 7
test-client-1  |   info: PUBLISH_NAMESPACE_OK received, PUBLISH_NAMESPACE_DONE sent
test-client-1  |   ...
test-client-1  | E0215 00:40:00.877964     1 MoQSession.cpp:2573] proxygen::WebTransport::Exception: session terminated with error=386759528 id=4 sess=0x563e76a336e0
test-client-1  | W0215 00:40:00.884306     1 MoQWebTransportClient.cpp:180] WebTransport: No WT-Protocol header in response, will use legacy version negotiation
relay-1        | [2026-02-15T00:40:00Z ERROR moq_transport::session::reader] [READER] decode: ERROR decoding moq_transport::message::Message - InvalidFilterType (buffer_len=39)
test-client-1  | E0215 00:40:00.884898     1 MoQWebTransportClient.cpp:205] proxygen::HTTPException: Got error=ApplicationError: No Error, Client closed by peer reason=
test-client-1  | E0215 00:40:00.885001     1 MoQSession.cpp:2573] proxygen::WebTransport::Exception: received invalid reset_stream with error=0 id=4 sess=0x563e76a413c0
test-client-1  | W0215 00:40:01.391896     1 MoQWebTransportClient.cpp:180] WebTransport: No WT-Protocol header in response, will use legacy version negotiation
test-client-1  | E0215 00:40:01.392963     1 MoQSession.cpp:2573] proxygen::WebTransport::Exception: session terminated with error=386759528 id=4 sess=0x563e76a2bf90
test-client-1  | ok 6 - subscribe-before-announce
test-client-1  |   ---
test-client-1  |   duration_ms: 514
test-client-1  |   info: Subscribe returned error (relay doesn't buffer pending subscriptions): Session closed
test-client-1  |   ...
[Ktest-client-1 exited with code 1
[31m[1mAborting on container exit...[0m
 Container main-test-client-1  Stopping
 Container main-test-client-1  Stopped
 Container main-relay-1  Stopping
 Container main-relay-1  Stopped
[Krelay-1 exited with code 137

make[1]: *** [Makefile:65: test] Error 1
make[1]: Leaving directory '/home/runner/work/moq-interop-runner/moq-interop-runner/main'
